<!DOCTYPE html>
<html>
    <head>
        <title>Students Zone</title>
        <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="studentszone.css">

    </head>
    <body>
    <div class="container">
        <div id="login-screen">
            <h1>Welcome to Student Zone</h1>
            <p>Enter any username to begin.</p>
            <input type="text" id="username-input" placeholder="e.g., CyberWarrior">
            <button id="login-btn" class="login-btn">Enter Zone</button>
        </div>

        <div id="student-zone-app">
            <header class="zone-header">
                <h1 id="welcome-message"></h1>
                <button class="create-post-btn" id="open-modal-btn"><i class="fas fa-plus"></i> Create Post</button>
            </header>
            <main class="feed" id="post-feed">
                <div id="empty-feed-message"><h3>No posts yet. Be the first one!</h3></div>
            </main>
        </div>
    </div>
    
    <div class="modal-overlay" id="post-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create a New Post</h2>
                <button class="close-modal-btn" id="close-modal-btn">&times;</button>
            </div>
            <form id="create-post-form">
                <textarea name="post-text" placeholder="What's on your mind?" required></textarea>
                <input type="file" name="post-image" accept="image/*" style="margin-top:15px;">
                <button type="submit" class="submit-post-btn">Post</button>
            </form>
        </div>
    </div>

    <script>
        // --- Global Variables ---
        let loggedInUser = null; // To store the current user's info
        const ONE_WEEK_IN_MS = 7 * 24 * 60 * 60 * 1000; // 1 week in milliseconds

        // --- DOM Elements ---
        const loginScreen = document.getElementById('login-screen');
        const appScreen = document.getElementById('student-zone-app');
        const loginBtn = document.getElementById('login-btn');
        const usernameInput = document.getElementById('username-input');
        const postFeed = document.getElementById('post-feed');
        const emptyFeedMessage = document.getElementById('empty-feed-message');
        const openModalBtn = document.getElementById('open-modal-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const postModal = document.getElementById('post-modal');
        const postForm = document.getElementById('create-post-form');
        const welcomeMessage = document.getElementById('welcome-message');

        // --- 1. LOGIN LOGIC ---
        loginBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            loggedInUser = { username: username }; // Set the logged in user
            
            // Switch screens
            loginScreen.style.display = 'none';
            appScreen.style.display = 'block';
            
            welcomeMessage.textContent = `Hello, ${loggedInUser.username}`;
            loadPostsFromStorage(); // Load posts after logging in
        });

        // --- 2. LOGIC FOR TEMPORARY POSTS & LOADING ---
        function loadPostsFromStorage() {
            // Get posts from browser's local storage
            const storedPosts = JSON.parse(localStorage.getItem('studentPosts') || '[]');
            
            const now = Date.now();
            
            // Filter out posts that are older than 1 week
            const validPosts = storedPosts.filter(post => {
                return (now - post.createdAt) < ONE_WEEK_IN_MS;
            });

            // Update the local storage with only valid (non-expired) posts
            localStorage.setItem('studentPosts', JSON.stringify(validPosts));
            
            // Display the valid posts on the screen
            renderPosts(validPosts);
        }
        
        function renderPosts(posts) {
            postFeed.innerHTML = ''; // Clear the feed first
            if (posts.length === 0) {
                postFeed.appendChild(emptyFeedMessage);
            } else {
                posts.forEach(post => {
                    const postElement = createPostElement(post);
                    postFeed.appendChild(postElement);
                });
            }
        }

        // --- 3. LOGIC FOR POST CREATION ---
        postForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const postText = event.target['post-text'].value;
            const postImageFile = event.target['post-image'].files[0];

            // Create a post object with the LOGGED IN USER's name and a timestamp
            const newPostData = {
                username: loggedInUser.username, // Dynamic username!
                text: postText,
                image: postImageFile ? URL.createObjectURL(postImageFile) : null,
                createdAt: Date.now() // Timestamp for expiry
            };

            // Add to the top of the feed visually
            const postElement = createPostElement(newPostData);
            postFeed.prepend(postElement);
            emptyFeedMessage.remove();

            // Save the new post to our browser "database"
            const allPosts = JSON.parse(localStorage.getItem('studentPosts') || '[]');
            allPosts.unshift(newPostData); // Add to the beginning
            localStorage.setItem('studentPosts', JSON.stringify(allPosts));

            postModal.classList.remove('active');
            postForm.reset();
        });

        // Helper function to create the HTML for a post
        function createPostElement(postData) {
            const article = document.createElement('article');
            article.className = 'post';

            const timeAgo = Math.round((Date.now() - postData.createdAt) / 60000); // in minutes
            const imageHTML = postData.image ? `<img src="${postData.image}" class="post-image">` : '';

            article.innerHTML = `
                <div class="post-header">
                    <span class="username">${postData.username}</span>
                    <span class="post-time" style="margin-left:auto; font-size:12px; color: #888;">${timeAgo} mins ago</span>
                </div>
                <div class="post-body">
                    <p>${postData.text}</p>
                    ${imageHTML}
                </div>
            `;
            return article;
        }

        // --- Modal open/close logic ---
        openModalBtn.addEventListener('click', () => postModal.classList.add('active'));
        closeModalBtn.addEventListener('click', () => postModal.classList.remove('active'));

    </script>


        </body>
        </html>